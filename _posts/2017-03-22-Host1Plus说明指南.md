---
layout:     post
title:      Host1Plus åº”ç”¨éƒ¨ç½²è¯´æ˜ŽæŒ‡å—
subtitle:    "ä½¿ç”¨node.js mongodbå¼€å‘è‡ªå·±çš„å°åº”ç”¨"
date:       2017-02-22
author:     leesx
header-img: img/post-bg-2015.jpg
catalog: true
tags:
    - node.js
    - åº”ç”¨éƒ¨ç½²
---

> â€œðŸ™‰ðŸ™‰ðŸ™‰ â€

## Host1Plus å¤‡å¿˜å½•

> IP ==185.141.165.28==

> è´¦å·: 105****063@qq.com

## nginx å¯åŠ¨

> ngnixç‰ˆæœ¬ä¸º 1.6.2

> nginxç›‘å¬ç«¯å£ ==80==

#### å¯åŠ¨å‘½ä»¤

```
/usr/local/webserver/nginx/sbin/nginx

```

#### Nginx å…¶ä»–å‘½ä»¤

```
/usr/local/webserver/nginx/sbin/nginx -s reload            # é‡æ–°è½½å…¥é…ç½®æ–‡ä»¶
/usr/local/webserver/nginx/sbin/nginx -s reopen            # é‡å¯ Nginx
/usr/local/webserver/nginx/sbin/nginx -s stop              # åœæ­¢ Nginx

```

> é…ç½®æ–‡ä»¶

```
/usr/local/webserver/nginx/conf/nginx.conf
```
> nodejsé…ç½®---ç«¯å£ä¸ŽåŸŸåé…ç½®

[å¤šåŸŸåé…ç½®å‚è€ƒæ–‡ç« ](http://www.cnblogs.com/freespider/p/4684586.html)

```
server {
listen 80;
server_name lishangxi.cn; #åŸŸå
    location / {
    proxy_pass http://127.0.0.1:8000;
    }
}
### é…ç½®å¤šåŸŸå
server {
listen 80;
server_name chat.lishangxi.cn; #åŸŸå
    location / {
    proxy_pass http://127.0.0.1:3000;
    }
}
```
==Nginxè§£æžåŸŸå,è½¬å‘ç»™æœ¬åœ°çš„nodejsçš„8000ç«¯å£~==

> nginxå®‰è£…åŠé…ç½®å‚è€ƒè¯´æ˜Ž

[é…ç½®å‚è€ƒæ–‡ç« ](http://www.runoob.com/linux/nginx-install-setup.html)

### Node.jsé¡¹ç›®ç›‘å¬ç«¯å£

> blog2017 ç›‘å¬ç«¯å£ ==8000==

> HiChat ç›‘å¬ç«¯å£ ==3000==

### å¯åŠ¨mongodb

> mongodbå®‰è£…ä½ç½® /usr/local/mongodb

> ==æ‰‹åŠ¨å¯åŠ¨ /usr/local/mongodb/bin/mongo==

- 1.ä¸‹è½½MongoDBï¼ˆ64ä½ï¼‰

`http://fastdl.mongodb.org/linux/mongodb-linux-x86_64-2.4.9.tgz`
æˆ–
`http://pan.baidu.com/s/1mgyRB8c`

- 2.å®‰è£…MongoDBï¼ˆå®‰è£…åˆ°/usr/localï¼‰

```
tar zxvf mongodb-linux-x86_64-2.4.9.tgz
mv mongodb-linux-x86_64-2.4.9 mongodb
cd mongodb
mkdir db
mkdir logs
cd bin
vi mongodb.conf

dbpath=/usr/local/mongodb/db
logpath=/usr/local/mongodb/logs/mongodb.log
port=27017
fork=true
nohttpinterface=true

```
- 3.é‡æ–°ç»‘å®šmongodbçš„é…ç½®æ–‡ä»¶åœ°å€å’Œè®¿é—®IP
```
/usr/local/mongodb/bin/mongod --bind_ip localhost -f /usr/local/mongodb/bin/mongodb.conf
```
- 4.å¼€æœºè‡ªåŠ¨å¯åŠ¨mongodb
```
vi /etc/rc.d/rc.local
/usr/local/mongodb/bin/mongod --config /usr/local/mongodb/bin/mongodb.conf
```
- 5.é‡å¯ä¸€ä¸‹ç³»ç»Ÿæµ‹è¯•ä¸‹èƒ½ä¸èƒ½è‡ªå¯
```
#è¿›å…¥mongodbçš„shellæ¨¡å¼
/usr/local/mongodb/bin/mongo
#æŸ¥çœ‹æ•°æ®åº“åˆ—è¡¨
show dbs
#å½“å‰dbç‰ˆæœ¬
```

>

### pm2å¸¸ç”¨å‘½ä»¤

- pm2 list ==å¯åŠ¨é¡¹ç›®çš„åˆ—è¡¨==

![](https://img3.doubanio.com/view/note/large/public/p10127862.jpg)
- pm2 stop [id] åœæ­¢é¡¹ç›®
- pm2 restart [id] é‡å¯é¡¹ç›®
- pm2 restart all ==é‡å¯æ‰€æœ‰è¿›ç¨‹==
- pm2 monit ==ç›‘è§†æ‰€æœ‰è¿›ç¨‹==
![](https://img1.doubanio.com/view/note/large/public/p10140518.jpg)
- pm2 logs ==æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹çš„æ—¥å¿—==
- pm2 stop all ==åœæ­¢æ‰€æœ‰è¿›ç¨‹==


```
$ npm install pm2 -g     # å‘½ä»¤è¡Œå®‰è£… pm2
$ pm2 start app.js -i 4 #åŽå°è¿è¡Œpm2ï¼Œå¯åŠ¨4ä¸ªapp.js
                                # ä¹Ÿå¯ä»¥æŠŠ'max' å‚æ•°ä¼ é€’ç»™ start
                                # æ­£ç¡®çš„è¿›ç¨‹æ•°ç›®ä¾èµ–äºŽCpuçš„æ ¸å¿ƒæ•°ç›®
$ pm2 start app.js --name my-api # å‘½åè¿›ç¨‹
$ pm2 list               # æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹çŠ¶æ€
$ pm2 monit              # ç›‘è§†æ‰€æœ‰è¿›ç¨‹
$ pm2 logs               #  æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹æ—¥å¿—
$ pm2 stop all           # åœæ­¢æ‰€æœ‰è¿›ç¨‹
$ pm2 restart all        # é‡å¯æ‰€æœ‰è¿›ç¨‹
$ pm2 reload all         # 0ç§’åœæœºé‡è½½è¿›ç¨‹ (ç”¨äºŽ NETWORKED è¿›ç¨‹)
$ pm2 stop 0             # åœæ­¢æŒ‡å®šçš„è¿›ç¨‹
$ pm2 restart 0          # é‡å¯æŒ‡å®šçš„è¿›ç¨‹
$ pm2 startup            # äº§ç”Ÿ init è„šæœ¬ ä¿æŒè¿›ç¨‹æ´»ç€
$ pm2 web                # è¿è¡Œå¥å£®çš„ computer API endpoint (http://localhost:9615)
$ pm2 delete 0           # æ€æ­»æŒ‡å®šçš„è¿›ç¨‹
$ pm2 delete all         # æ€æ­»å…¨éƒ¨è¿›ç¨‹

è¿è¡Œè¿›ç¨‹çš„ä¸åŒæ–¹å¼ï¼š
$ pm2 start app.js -i max  # æ ¹æ®æœ‰æ•ˆCPUæ•°ç›®å¯åŠ¨æœ€å¤§è¿›ç¨‹æ•°ç›®
$ pm2 start app.js -i 3      # å¯åŠ¨3ä¸ªè¿›ç¨‹
$ pm2 start app.js -x        #ç”¨forkæ¨¡å¼å¯åŠ¨ app.js è€Œä¸æ˜¯ä½¿ç”¨ cluster
$ pm2 start app.js -x -- -a 23   # ç”¨forkæ¨¡å¼å¯åŠ¨ app.js å¹¶ä¸”ä¼ é€’å‚æ•° (-a 23)
$ pm2 start app.js --name serverone  # å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹å¹¶æŠŠå®ƒå‘½åä¸º serverone
$ pm2 stop serverone       # åœæ­¢ serverone è¿›ç¨‹
$ pm2 start app.json        # å¯åŠ¨è¿›ç¨‹, åœ¨ app.jsoné‡Œè®¾ç½®é€‰é¡¹
$ pm2 start app.js -i max -- -a 23                   #åœ¨--ä¹‹åŽç»™ app.js ä¼ é€’å‚æ•°
$ pm2 start app.js -i max -e err.log -o out.log  # å¯åŠ¨ å¹¶ ç”Ÿæˆä¸€ä¸ªé…ç½®æ–‡ä»¶
ä½ ä¹Ÿå¯ä»¥æ‰§è¡Œç”¨å…¶ä»–è¯­è¨€ç¼–å†™çš„app  ( fork æ¨¡å¼):
$ pm2 start my-bash-script.sh    -x --interpreter bash
$ pm2 start my-python-script.py -x --interpreter python

0ç§’åœæœºé‡è½½:
è¿™é¡¹åŠŸèƒ½å…è®¸ä½ é‡æ–°è½½å…¥ä»£ç è€Œä¸ç”¨å¤±åŽ»è¯·æ±‚è¿žæŽ¥ã€‚
æ³¨æ„ï¼š
ä»…èƒ½ç”¨äºŽwebåº”ç”¨
è¿è¡ŒäºŽNode 0.11.xç‰ˆæœ¬
è¿è¡ŒäºŽ cluster æ¨¡å¼ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰
$ pm2 reload all

CoffeeScript:
$ pm2 start my_app.coffee  #è¿™å°±æ˜¯å…¨éƒ¨

PM2å‡†å¤‡å¥½ä¸ºäº§å“çº§æœåŠ¡äº†å—ï¼Ÿ
åªéœ€åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šæµ‹è¯•
$ git clone https://github.com/Unitech/pm2.git
$ cd pm2
$ npm install  # æˆ–è€… npm install --dev ï¼Œå¦‚æžœdevDependencies æ²¡æœ‰å®‰è£…
$ npm test

pm2 list
```

### é…ç½®VPNæœåŠ¡å™¨

> ä¸€é”®éƒ¨ç½²VPSï¼ˆå¤åˆ¶ä¸‹é¢çš„ä»£ç å¹¶æŒ‰å›žè½¦ã€‚ ä¸­é€”ä¼šæç¤ºè®¾ç½®ç«¯å£å’Œå¯†ç ï¼Œå¦‚æžœç›´æŽ¥å›žè½¦ä½¿ç”¨çš„æ˜¯é»˜è®¤é…ç½®ï¼‰

```
wget â€“no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh
chmod +x shadowsocks.sh
./shadowsocks.sh 2>&1 | tee shadowsocks.log
```

### è®¾ç½®çŽ¯å¢ƒå˜é‡

> window ä¸‹ åœ¨cmdä¸‹
` set NODE_ENV = development `

> linux ä¸‹
` export NODE_ENV = production `
